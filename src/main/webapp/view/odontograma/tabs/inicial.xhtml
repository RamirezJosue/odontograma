<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:p="http://primefaces.org/ui"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets">
	<h:outputStylesheet>
        .odontograma-flex {
            display: flex;
            justify-content: space-between;
            margin-bottom: 2rem;
        }
        
        .flex-left, .flex-right {
            width: 48%;
        }
        
        .hallazgos {
            margin-bottom: 2rem;
        }
        
        .registro-hallazgos-table {
            width: 100%;
        }
        
        /* Estilos para la sección de evaluación */
        .evaluacion-section {
            width: 100%;
            margin-top: 20px;
        }
        
        .evaluacion-fieldset {
            border: 1px solid #ddd;
            padding: 20px;
            border-radius: 8px;
            background-color: #f9f9f9;
        }
        
        .evaluacion-combo-container {
            margin-bottom: 20px;
        }
        
        .evaluacion-combo-container label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #333;
        }
        
        .evaluacion-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .evaluacion-superior,
        .evaluacion-inferior {
            display: flex;
            gap: 50px;
        }
        
        .evaluacion-subsection {
            flex: 1;
            display: flex;
            flex-direction: column;
        }
        
        .evaluacion-subsection label {
            margin-bottom: 8px;
            font-weight: bold;
            color: #333;
        }
        
        .evaluacion-textarea {
            width: 100%;
            min-height: 120px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            resize: vertical;
            font-family: inherit;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .odontograma-flex {
                flex-direction: column;
            }
            
            .flex-left, .flex-right {
                width: 100%;
                margin-bottom: 1rem;
            }
            
            .evaluacion-superior,
            .evaluacion-inferior {
                flex-direction: column;
            }
        }
        
        
        /* ***************** MODAL *****************  */
        
		/* IMPLANTE */
		 .implanteContenedor{
        	padding: 10px 15px; 
        	border: 2px solid rgb(211, 224, 235); 
        	border-radius: 5px; 
        	margin-bottom:10px;
        }
        
        .implanteCard{
        	display: flex; 
        	justify-content: space-between; 
        	align-items: center;
        }
		.implanteBtncontainer{
        	display: flex; 
        	gap: 10px
        }   
		  .implanteBtnAzul.ui-button{
			border-radius: 100%;
			width: 40px;
			height: 40px;
			font-size: 14px;
			color: blue;	
			border:2px solid blue;
			background: #fff;
			display: flex;
			align-items: center;
			justify-content: center;     
        }
        
        .implanteBtnRojo.ui-button{
        	border-radius: 100%;
			width: 40px;
			height: 40px;
			font-size: 14px;
			color: red;	
			border:2px solid red;
			background: #fff;
			display: flex;
			align-items: center;
			justify-content: center;
        }
		
		/* CARIES */
        .cariesContenedor{
        	padding: 10px 15px; 
        	border: 2px solid rgb(211, 224, 235); 
        	border-radius: 5px; 
        	margin-bottom:10px;
        }
        
        .cariesCard{
        	display: flex; 
        	justify-content: space-between; 
        	align-items: center;
        }
        
        .cariesBtncontainer{
        	display: flex; 
        	gap: 10px
        }               
        
        .cariesBtnRojo.ui-button{
        	border-radius: 100%;
			width: 40px;
			height: 40px;
			font-size: 14px;
			color: red;	
			border:2px solid red;
			background: #fff;
			display: flex;
			align-items: center;
			justify-content: center;
        }
             
        .cariesBtnRojoFull.ui-button{
        	border-radius: 100%;
			width: 40px;
			height: 40px;
			font-size: 14px;
			color: red;	
			border:20px solid red;
			background: red;
        }
        
       .cariesBtnRojoAzul.ui-button {
		    width: 40px;
		    height: 40px;
		    border-radius: 50%;
		    font-size: 14px;
		    color: white !important;
		    border: none !important;		    
		    background: linear-gradient(to right, 
		                #2196F3 50%, 
		                #f44336 50%) !important;
		}

        
        	
    </h:outputStylesheet>
	<div class="odontograma-flex">
		<div class="flex-left">
			<h:form id="formDenticion">
				<p:fieldset legend="Seleccione el Tipo de Dentición">
					<p:selectOneRadio id="denticionRadio"
						value="#{odontogramaBean.tipoDenticion}"
						onchange="tipoDenticion = this.value; actualizarOdontograma();">

						<f:selectItem itemLabel="Dentición Mixta" itemValue="mixta" />
						<f:selectItem itemLabel="Dentición Permanente"
							itemValue="permanente" />
						<f:selectItem itemLabel="Dentición Decidua" itemValue="decidua" />

					</p:selectOneRadio>
				</p:fieldset>
			</h:form>
		</div>
		<div class="flex-right">
			<p:fieldset legend="Seleccione la Fecha de Creación">
				<p:datePicker pattern="yyyy-MM-dd" showIcon="true" />
			</p:fieldset>
		</div>
	</div>

	<div style="margin: 2rem 0; text-align: center; overflow-x: auto;">
		<svg id="odontograma" preserveAspectRatio="xMidYMid meet"
			style="border: 1px solid #ddd; background: white; display: block; margin: 0 auto;">
        </svg>
	</div>

	<div class="hallazgos">
		<p:fieldset legend="Registro de Hallazgos">
			<h:form id="formHallazgos">
				<p:dataTable value="#{odontogramaBean.hallazgos}" var="h"
					styleClass="registro-hallazgos-table" editable="true">

					<p:column headerText="N° Pieza Dental">
						<h:outputText value="#{h.piezaDental}" />
					</p:column>

					<p:column headerText="Hallazgo">
						<h:outputText value="#{h.descripcion}" />
					</p:column>

					<p:column headerText="Cantidad">
						<h:outputText value="#{h.cantidad}" />
					</p:column>

					<p:column headerText="Nota">
						<p:inputTextarea value="#{h.nota}" autoResize="true" />
					</p:column>
				</p:dataTable>

				<br />

				<p:commandButton value="Adicionar Nuevo Hallazgo" icon="pi pi-plus"
					action="#{odontogramaBean.adicionarHallazgo}"
					update="formHallazgos" />

				<h:panelGroup style="margin-left:20px">
					<strong>Total:</strong> #{odontogramaBean.totalHallazgos}
                </h:panelGroup>
			</h:form>
		</p:fieldset>
	</div>

	<div class="evaluacion-section">
		<p:fieldset legend="Evaluación Odontológica"
			styleClass="evaluacion-fieldset">
			<div class="evaluacion-combo-container">
				<h:outputLabel for="diagnosticoCombo"
					value="Seleccione Diagnóstico CIE-10:" />
				<p:selectOneMenu id="diagnosticoCombo" styleClass="evaluacion-combo"
					filter="true" filterMatchMode="contains" panelStyle="width:400px">

					<f:selectItem itemLabel="Seleccione..." itemValue=""
						noSelectionOption="true" />
					<f:selectItem itemLabel="K02 - Caries dental" itemValue="K02" />
					<f:selectItem
						itemLabel="K03 - Otras enfermedades de los tejidos dentales duros"
						itemValue="K03" />
					<f:selectItem
						itemLabel="K04 - Enfermedades de la pulpa y de los tejidos periapicales"
						itemValue="K04" />
					<f:selectItem
						itemLabel="K05 - Gingivitis y enfermedades periodontales"
						itemValue="K05" />
					<f:selectItem
						itemLabel="K06 - Otros trastornos de la encía y de la zona edéntula"
						itemValue="K06" />
					<f:selectItem itemLabel="K07 - Anomalías dentofaciales"
						itemValue="K07" />
					<f:selectItem
						itemLabel="K08 - Otros trastornos de los dientes y de sus estructuras de sostén"
						itemValue="K08" />
					<f:selectItem itemLabel="K09 - Quistes de la región bucal"
						itemValue="K09" />
					<f:selectItem itemLabel="K10 - Otros trastornos de los maxilares"
						itemValue="K10" />
					<f:selectItem
						itemLabel="K11 - Enfermedades de las glándulas salivales"
						itemValue="K11" />
					<f:selectItem itemLabel="K12 - Estomatitis y lesiones afines"
						itemValue="K12" />
					<f:selectItem
						itemLabel="K13 - Otras enfermedades del labio y de la mucosa bucal"
						itemValue="K13" />
					<f:selectItem itemLabel="K14 - Enfermedades de la lengua"
						itemValue="K14" />
				</p:selectOneMenu>
			</div>
			<div class="evaluacion-container">
				<div class="evaluacion-superior">
					<div class="evaluacion-subsection">
						<h:outputLabel for="especificaciones" value="Especificaciones:" />
						<p:inputTextarea id="especificaciones" rows="5" cols="50"
							autoResize="true" placeholder="Ingrese las especificaciones..."
							styleClass="evaluacion-textarea" />
					</div>

					<div class="evaluacion-subsection">
						<h:outputLabel for="diagnostico" value="Diagnóstico:" />
						<p:inputTextarea id="diagnostico" rows="5" cols="50"
							autoResize="true"
							placeholder="Ingrese el diagnóstico del paciente..."
							styleClass="evaluacion-textarea" />
					</div>
				</div>
				<div class="evaluacion-inferior">
					<div class="evaluacion-subsection">
						<h:outputLabel for="observaciones" value="Observaciones:" />
						<p:inputTextarea id="observaciones" rows="5" cols="50"
							autoResize="true" placeholder="Ingrese sus observaciones..."
							styleClass="evaluacion-textarea" />
					</div>

					<div class="evaluacion-subsection">
						<h:outputLabel for="planTrabajo" value="Plan de Trabajo:" />
						<p:inputTextarea id="planTrabajo" rows="5" cols="50"
							autoResize="true" placeholder="Ingrese el plan de trabajo..."
							styleClass="evaluacion-textarea" />
					</div>
				</div>
			</div>
			<div style="margin-top: 20px; text-align: right;">
				<p:commandButton value="Guardar Evaluación" icon="pi pi-save"
					styleClass="ui-button-success" disabled="true" />

				<p:commandButton value="Limpiar" icon="pi pi-trash"
					styleClass="ui-button-secondary" style="margin-left: 10px;"
					disabled="true" />

				<p:commandButton value="Imprimir" icon="pi pi-print"
					style="margin-left: 10px;" disabled="true" />
			</div>

		</p:fieldset>
	</div>

	<p:dialog id="dlgServicio" widgetVar="dlgServicio"
		header="Seleccione un Servicio" modal="true" width="700"
		appendTo="@(body)" responsive="true" resizable="false"
		contentStyle="overflow-x:hidden;">
		<h:form id="formServicio">
			<div
				style="display: flex; flex-direction: column; align-items: center; width: 100%;">
				<p:selectOneMenu id="servicio"
					value="#{odontogramaBean.servicioSeleccionado}"
					style="width:90%; margin-bottom:20px">

					<f:selectItem itemLabel="Seleccione..." itemValue=""
						noSelectionOption="true" />
					<f:selectItem itemLabel="Implante" itemValue="implante" />
					<f:selectItem itemLabel="Caries" itemValue="caries" />
					<f:selectItem itemLabel="Diente Ausente" itemValue="dienteAusente" />
					<f:selectItem itemLabel="Protesis Dental"
						itemValue="protesisDental" />
					<f:selectItem itemLabel="Restauración" itemValue="restauracion" />
					<f:selectItem itemLabel="Extracción" itemValue="extraccion" />

					<p:ajax event="valueChange"
						listener="#{odontogramaBean.onServicioChange}" process="@form"
						update="formServicio:panelDinamico" />

				</p:selectOneMenu>

				<p:outputPanel id="panelDinamico"
					style="width:90%; margin-bottom:20px">

					<!-- ========= IMPLANTE ========= -->
					<p:outputPanel
						rendered="#{odontogramaBean.servicioSeleccionado eq 'implante'}">
						<div class="implanteContenedor">
							<div class="implanteCard">
								<div>
									<p>Implante Dental</p>
								</div>
								<div class="cariesBtncontainer">
									<p:commandButton value="IMP" process="@form"
										styleClass="implanteBtnAzul"
										update="formServicio:panelDinamico"
										actionListener="#{odontogramaBean.setSubtipoSeleccionado('IMPA')}" />
									<p:commandButton value="IMP" process="@form"
										styleClass="implanteBtnRojo"
										update="formServicio:panelDinamico"
										actionListener="#{odontogramaBean.setSubtipoSeleccionado('IMPR')}" />
								</div>
							</div>
						</div>
					</p:outputPanel>

					<!-- ========= CARIES ========= -->
					<p:outputPanel
						rendered="#{odontogramaBean.servicioSeleccionado eq 'caries'}">
						<div class="cariesContenedor">
							<div class="cariesCard">
								<div>
									<p>Caries Dental</p>
								</div>
								<div class="cariesBtncontainer">
									<p:commandButton value="" process="@form"
										styleClass="cariesBtnRojoFull"
										update="formServicio:panelDinamico"
										actionListener="#{odontogramaBean.setSubtipoSeleccionado('CD')}" />
								</div>
							</div>
						</div>
						<div class="cariesContenedor">
							<div class="cariesCard">
								<div>
									<p>Caries Recurrente</p>
								</div>
								<div class="cariesBtncontainer">
									<p:commandButton value="" process="@form"
										styleClass="cariesBtnRojoAzul"
										update="formServicio:panelDinamico"
										actionListener="#{odontogramaBean.setSubtipoSeleccionado('CR')}" />
								</div>
							</div>
						</div>
						<div class="cariesContenedor">
							<div class="cariesCard">
								<div>
									<p>Caries a Nivel del Esmalte</p>
								</div>
								<div class="cariesBtncontainer">
									<p:commandButton value="CE" process="@form"
										styleClass="cariesBtnRojo" update="formServicio:panelDinamico"
										actionListener="#{odontogramaBean.setSubtipoSeleccionado('CE')}" />
								</div>
							</div>
						</div>
						<div class="cariesContenedor">
							<div class="cariesCard">
								<div>
									<p>Caries a Nivel de la Dentina</p>
								</div>
								<div class="cariesBtncontainer">
									<p:commandButton value="CD" process="@form"
										styleClass="cariesBtnRojo" update="formServicio:panelDinamico"
										actionListener="#{odontogramaBean.setSubtipoSeleccionado('CD')}" />
								</div>
							</div>
						</div>
						<div class="cariesContenedor">
							<div class="cariesCard">
								<div>
									<p>Caries a Nivel de la Pulpa</p>
								</div>
								<div class="cariesBtncontainer">
									<p:commandButton value="CDP" process="@form"
										styleClass="cariesBtnRojo" update="formServicio:panelDinamico"
										actionListener="#{odontogramaBean.setSubtipoSeleccionado('CDP')}" />
								</div>
							</div>
						</div>
						<div class="cariesContenedor">
							<div class="cariesCard">
								<div>
									<p>Mancha Blanca</p>
								</div>
								<div class="cariesBtncontainer">
									<p:commandButton value="MB" process="@form"
										styleClass="cariesBtnRojo" update="formServicio:panelDinamico"
										actionListener="#{odontogramaBean.setSubtipoSeleccionado('MB')}" />
								</div>
							</div>
						</div>
					</p:outputPanel>

					<!-- ========= DIENTE AUSENTE ========= -->
					<p:outputPanel
						rendered="#{odontogramaBean.servicioSeleccionado eq 'dienteAusente'}">
						<div class="implanteContenedor">
							<div class="implanteCard">
								<div>
									<p>Diente Extraído por Caries</p>
								</div>
								<div class="cariesBtncontainer">
									<p:commandButton value="DEX" process="@form"
										styleClass="implanteBtnAzul"
										update="formServicio:panelDinamico"
										actionListener="#{odontogramaBean.setSubtipoSeleccionado('DEX')}" />
								</div>
							</div>
						</div>
						<div class="implanteContenedor">
							<div class="implanteCard">
								<div>
									<p>Diente No Erupcionado</p>
								</div>
								<div class="cariesBtncontainer">
									<p:commandButton value="DNE" process="@form"
										styleClass="implanteBtnAzul"
										update="formServicio:panelDinamico"
										actionListener="#{odontogramaBean.setSubtipoSeleccionado('DNE')}" />
								</div>
							</div>
						</div>
						<div class="implanteContenedor">
							<div class="implanteCard">
								<div>
									<p>Diente Ausente por Otra Razón</p>
								</div>
								<div class="cariesBtncontainer">
									<p:commandButton value="DAO" process="@form"
										styleClass="implanteBtnAzul"
										update="formServicio:panelDinamico"
										actionListener="#{odontogramaBean.setSubtipoSeleccionado('DAO')}" />
								</div>
							</div>
						</div>
					</p:outputPanel>

					<!-- ========= PROTESIS DENTAL ========= -->

					<p:outputPanel
						rendered="#{odontogramaBean.servicioSeleccionado eq 'protesisDental'}">
						<div class="implanteContenedor">
							<div class="implanteCard">
								<div>
									<p>Prótesis Dental</p>
								</div>
								<div class="cariesBtncontainer">
									<p:commandButton value="P" process="@form"
										styleClass="implanteBtnAzul"
										update="formServicio:panelDinamico"
										actionListener="#{odontogramaBean.setSubtipoSeleccionado('P')}" />
									<p:commandButton value="P" process="@form"
										styleClass="implanteBtnRojo"
										update="formServicio:panelDinamico"
										actionListener="#{odontogramaBean.setSubtipoSeleccionado('P')}" />
								</div>
							</div>
						</div>
						<div class="implanteContenedor">
							<div class="implanteCard">
								<div>
									<p>Prótesis Dental Parcial Fija</p>
								</div>
								<div class="cariesBtncontainer">
									<p:commandButton value="--" process="@form"
										styleClass="implanteBtnAzul"
										update="formServicio:panelDinamico"
										actionListener="#{odontogramaBean.setSubtipoSeleccionado('P')}" />
									<p:commandButton value="--" process="@form"
										styleClass="implanteBtnRojo"
										update="formServicio:panelDinamico"
										actionListener="#{odontogramaBean.setSubtipoSeleccionado('P')}" />
								</div>
							</div>
						</div>
						<div class="implanteContenedor">
							<div class="implanteCard">
								<div>
									<p>Prótesis Dental Completa Superior / Inferior</p>
								</div>
								<div class="cariesBtncontainer">
									<p:commandButton value="=" process="@form"
										styleClass="implanteBtnAzul"
										update="formServicio:panelDinamico"
										actionListener="#{odontogramaBean.setSubtipoSeleccionado('P')}" />
									<p:commandButton value="=" process="@form"
										styleClass="implanteBtnRojo"
										update="formServicio:panelDinamico"
										actionListener="#{odontogramaBean.setSubtipoSeleccionado('P')}" />
								</div>
							</div>
						</div>
						<div class="implanteContenedor">
							<div class="implanteCard">
								<div>
									<p>Prótesis Dental Parcial Removible</p>
								</div>
								<div class="cariesBtncontainer">
									<p:commandButton value="*=" process="@form"
										styleClass="implanteBtnAzul"
										update="formServicio:panelDinamico"
										actionListener="#{odontogramaBean.setSubtipoSeleccionado('P')}" />
									<p:commandButton value="*=" process="@form"
										styleClass="implanteBtnRojo"
										update="formServicio:panelDinamico"
										actionListener="#{odontogramaBean.setSubtipoSeleccionado('P')}" />
								</div>
							</div>
						</div>
					</p:outputPanel>

					<!-- ========= RESTAURACION ========= -->

					<p:outputPanel
						rendered="#{odontogramaBean.servicioSeleccionado eq 'restauracion'}">
						<div class="implanteContenedor">
							<div class="implanteCard">
								<div>
									<p>Amalgama Dental</p>
								</div>
								<div class="cariesBtncontainer">
									<p:commandButton value="AM" process="@form"
										styleClass="implanteBtnAzul"
										update="formServicio:panelDinamico"
										actionListener="#{odontogramaBean.setSubtipoSeleccionado('AM')}" />
									<p:commandButton value="AM" process="@form"
										styleClass="implanteBtnRojo"
										update="formServicio:panelDinamico"
										actionListener="#{odontogramaBean.setSubtipoSeleccionado('AM')}" />
								</div>
							</div>
						</div>
						<div class="implanteContenedor">
							<div class="implanteCard">
								<div>
									<p>Resina</p>
								</div>
								<div class="cariesBtncontainer">
									<p:commandButton value="R" process="@form"
										styleClass="implanteBtnAzul"
										update="formServicio:panelDinamico"
										actionListener="#{odontogramaBean.setSubtipoSeleccionado('R')}" />
									<p:commandButton value="R" process="@form"
										styleClass="implanteBtnRojo"
										update="formServicio:panelDinamico"
										actionListener="#{odontogramaBean.setSubtipoSeleccionado('R')}" />
								</div>
							</div>
						</div>
						<div class="implanteContenedor">
							<div class="implanteCard">
								<div>
									<p>Iónomero de Vidrio</p>
								</div>
								<div class="cariesBtncontainer">
									<p:commandButton value="IV" process="@form"
										styleClass="implanteBtnAzul"
										update="formServicio:panelDinamico"
										actionListener="#{odontogramaBean.setSubtipoSeleccionado('IV')}" />
									<p:commandButton value="IV" process="@form"
										styleClass="implanteBtnRojo"
										update="formServicio:panelDinamico"
										actionListener="#{odontogramaBean.setSubtipoSeleccionado('IV')}" />
								</div>
							</div>
						</div>
						<div class="implanteContenedor">
							<div class="implanteCard">
								<div>
									<p>Incrustación Metálica</p>
								</div>
								<div class="cariesBtncontainer">
									<p:commandButton value="IM" process="@form"
										styleClass="implanteBtnAzul"
										update="formServicio:panelDinamico"
										actionListener="#{odontogramaBean.setSubtipoSeleccionado('IM')}" />
									<p:commandButton value="IM" process="@form"
										styleClass="implanteBtnRojo"
										update="formServicio:panelDinamico"
										actionListener="#{odontogramaBean.setSubtipoSeleccionado('IM')}" />
								</div>
							</div>
						</div>
						<div class="implanteContenedor">
							<div class="implanteCard">
								<div>
									<p>Incrustación Estética</p>
								</div>
								<div class="cariesBtncontainer">
									<p:commandButton value="IE" process="@form"
										styleClass="implanteBtnAzul"
										update="formServicio:panelDinamico"
										actionListener="#{odontogramaBean.setSubtipoSeleccionado('IE')}" />
									<p:commandButton value="IE" process="@form"
										styleClass="implanteBtnRojo"
										update="formServicio:panelDinamico"
										actionListener="#{odontogramaBean.setSubtipoSeleccionado('IE')}" />
								</div>
							</div>
						</div>
						<div class="implanteContenedor">
							<div class="implanteCard">
								<div>
									<p>Carilla</p>
								</div>
								<div class="cariesBtncontainer">
									<p:commandButton value="C" process="@form"
										styleClass="implanteBtnAzul"
										update="formServicio:panelDinamico"
										actionListener="#{odontogramaBean.setSubtipoSeleccionado('C')}" />
									<p:commandButton value="C" process="@form"
										styleClass="implanteBtnRojo"
										update="formServicio:panelDinamico"
										actionListener="#{odontogramaBean.setSubtipoSeleccionado('C')}" />
								</div>
							</div>
						</div>
					</p:outputPanel>


					<p:outputPanel
						rendered="#{empty odontogramaBean.servicioSeleccionado}">
						<div style="padding: 20px; text-align: center; color: #666;">
							Por favor, seleccione un servicio para ver las opciones
							disponibles.</div>
					</p:outputPanel>

				</p:outputPanel>


				<p:commandButton value="Aceptar"
					action="#{odontogramaBean.guardarServicio}" update="formServicio"
					oncomplete="if(args &amp;&amp; args.subtipo){ pintarTexto(args.subtipo); PF('dlgServicio').hide(); }" />


				<p:remoteCommand name="enviarDiente"
					actionListener="#{odontogramaBean.setDienteSeleccionado(param.dienteSeleccionado)}" />


			</div>
		</h:form>
	</p:dialog>

</ui:composition>